基本使用教程
============

Bootarmor 支持在 Debian Linux 中直接安装一个新的安全内核，就可以将原来
的系统升级成为可以运行安全应用的操作系统，使用安全内核的操作系统下文中
简称为 `btarmor-os`_

安全内核有两种模式

* 开发模式
* 发布模式

安装新的安全内核之后，重新启动系统就进入到开发模式。在开发模式下面，原
来的可执行文件和动态库还可以继续使用。

开发模式一般用于产品的开发阶段，在产品开发完成之后，需要发布系统到用户
的时候，就需要切换到发布模式。

在开发模式下面运行命令 `btarmor deploy` 就切换到发布模式。在发布模式下
面，所有的可执行文件和动态库都必须是安全应用才可以运行。

安装包命令行工具
----------------

1. 修改 `/etc/apt/source.list` ，增加一行::

     deb https://btarmor.dashingsoft.com/btarmor bullseye main

2. 更新安装源::

     sudo apt update

3. 安装命令行工具 :ref:`btarmor`::

     apt get btarmor-cli


安装安全内核
------------

安装安全内核，如果当前系统使用的是通用的内核，那么直接使用下面的命令安
装安全内核::

  sudo btarmor boot

然后重新启动系统即可。

如果是对内核进行了定制，那么需要下载相应内核版本的 `btarmor-os`_ 的补
丁，然后重新生成 Linux 内核，并替换原来的内核即可。

使用下面的命令可以下载和当前内核版本相同的补丁::

  btarmor patch

也可以从下面的链接直接下载对应版本的 `btarmor-os`_ 补丁::

    https://btarmor.dashingsoft.com/kernel/patches/

创建安全应用
------------

创建安全应用就是把原来的可执行文件，动态库和数据文件使用命令转换成为安全应用。

例如，转换被保护的应用程序 ``/opt/foo`` 为安全应用::

     btamor make -i /opt/foo

发布安全系统
------------

当所有开发完成之后，将产品交付给用户之前，需要把安全内核转换成为发布模
式，转换成为发布模式之后只有安全应用可以正常运行，其它可执行文件和动态
库都无法使用。

使用下面的命令转换安全内核为发布模式::

  btarmor deploy

现在可以把产品交付给给用户使用。

.. include:: _common_definitions.txt
